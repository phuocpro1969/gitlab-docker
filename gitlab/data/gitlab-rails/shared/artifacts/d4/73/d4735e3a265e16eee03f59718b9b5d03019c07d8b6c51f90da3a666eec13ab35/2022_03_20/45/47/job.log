[0KRunning with gitlab-runner 14.8.2 (c6e7e194)[0;m
[0K  on docker 8g8VfLmE[0;m
section_start:1647782672:prepare_executor[0K[0K[36;1mPreparing the "docker" executor[0;m[0;m
[0KUsing Docker executor with image amazon/aws-cli:2.4.11 ...[0;m
[0KStarting service docker:20.10.13-dind ...[0;m
[0KPulling docker image docker:20.10.13-dind ...[0;m
[0KUsing docker image sha256:12be8f658512ce5ca4f7e20a59a0ed17f592a41171a46ffd45888643b83eb598 for docker:20.10.13-dind with digest docker@sha256:e37536394e82073384d22a24a3514496eeee2890c823cfb94628ced9ae387a01 ...[0;m
[0KWaiting for services to be up and running...[0;m

[0;33m*** WARNING:[0;m Service runner-8g8vflme-project-2-concurrent-0-ab06f89877ab4c69-docker-0 probably didn't start properly.

Health check error:
service "runner-8g8vflme-project-2-concurrent-0-ab06f89877ab4c69-docker-0-wait-for-service" timeout

Health check container logs:


Service container logs:
2022-03-20T13:24:34.154761368Z Generating RSA private key, 4096 bit long modulus (2 primes)
2022-03-20T13:24:34.228625357Z ...........++++
2022-03-20T13:24:34.522416126Z ....................................................++++
2022-03-20T13:24:34.522443055Z e is 65537 (0x010001)
2022-03-20T13:24:34.545742191Z Generating RSA private key, 4096 bit long modulus (2 primes)
2022-03-20T13:24:34.559003049Z .++++
2022-03-20T13:24:34.859846583Z ..................................................................++++
2022-03-20T13:24:34.860373083Z e is 65537 (0x010001)
2022-03-20T13:24:34.897843367Z Signature ok
2022-03-20T13:24:34.897873245Z subject=CN = docker:dind server
2022-03-20T13:24:34.898087921Z Getting CA Private Key
2022-03-20T13:24:34.912526588Z /certs/server/cert.pem: OK
2022-03-20T13:24:34.916855282Z Generating RSA private key, 4096 bit long modulus (2 primes)
2022-03-20T13:24:35.596635304Z ........................................................................................................................................................++++
2022-03-20T13:24:35.625811007Z .....++++
2022-03-20T13:24:35.626350249Z e is 65537 (0x010001)
2022-03-20T13:24:35.656203148Z Signature ok
2022-03-20T13:24:35.656232190Z subject=CN = docker:dind client
2022-03-20T13:24:35.656567838Z Getting CA Private Key
2022-03-20T13:24:35.672225991Z /certs/client/cert.pem: OK
2022-03-20T13:24:35.765526538Z time="2022-03-20T13:24:35.765272806Z" level=info msg="Starting up"
2022-03-20T13:24:35.767643629Z time="2022-03-20T13:24:35.767509049Z" level=warning msg="could not change group /var/run/docker.sock to docker: group docker not found"
2022-03-20T13:24:35.767730379Z failed to load listeners: can't create unix socket /var/run/docker.sock: device or resource busy

[0;33m*********[0;m

[0KPulling docker image amazon/aws-cli:2.4.11 ...[0;m
[0KUsing docker image sha256:3e880fcd134b187fb3b4f61f3b9ba13d24df4a3189af2ea7774b71280970fe25 for amazon/aws-cli:2.4.11 with digest amazon/aws-cli@sha256:8effaed358d0a64920a57c697c6f9ddb779f02ead955401d3bc4f28cfaedf969 ...[0;m
section_end:1647782706:prepare_executor[0Ksection_start:1647782706:prepare_script[0K[0K[36;1mPreparing environment[0;m[0;m
Running on runner-8g8vflme-project-2-concurrent-0 via 8c4e00366ed6...
section_end:1647782706:prepare_script[0Ksection_start:1647782706:get_sources[0K[0K[36;1mGetting source from Git repository[0;m[0;m
[32;1mFetching changes with git depth set to 20...[0;m
Reinitialized existing Git repository in /builds/root/learn_ci/.git/
[32;1mChecking out 6142300c as main...[0;m
Removing build/

[32;1mSkipping Git submodules setup[0;m
section_end:1647782707:get_sources[0Ksection_start:1647782707:download_artifacts[0K[0K[36;1mDownloading artifacts[0;m[0;m
[32;1mDownloading artifacts for build website (39)...[0;m
Downloading artifacts from coordinator... ok      [0;m  id[0;m=39 responseStatus[0;m=200 OK token[0;m=o7F5njDp
section_end:1647782708:download_artifacts[0Ksection_start:1647782708:step_script[0K[0K[36;1mExecuting "step_script" stage of the job script[0;m[0;m
[0KUsing docker image sha256:3e880fcd134b187fb3b4f61f3b9ba13d24df4a3189af2ea7774b71280970fe25 for amazon/aws-cli:2.4.11 with digest amazon/aws-cli@sha256:8effaed358d0a64920a57c697c6f9ddb779f02ead955401d3bc4f28cfaedf969 ...[0;m
[32;1m$ aws --version[0;m
aws-cli/2.4.11 Python/3.8.8 Linux/5.4.0-1064-gcp docker/x86_64.amzn.2 prompt/off
[32;1m$ yum install -y gettext[0;m
Loaded plugins: ovl, priorities
Resolving Dependencies
--> Running transaction check
---> Package gettext.x86_64 0:0.19.8.1-3.amzn2 will be installed
--> Processing Dependency: gettext-libs(x86-64) = 0.19.8.1-3.amzn2 for package: gettext-0.19.8.1-3.amzn2.x86_64
--> Processing Dependency: libgomp.so.1(GOMP_4.0)(64bit) for package: gettext-0.19.8.1-3.amzn2.x86_64
--> Processing Dependency: libgomp.so.1(GOMP_1.0)(64bit) for package: gettext-0.19.8.1-3.amzn2.x86_64
--> Processing Dependency: libgomp.so.1()(64bit) for package: gettext-0.19.8.1-3.amzn2.x86_64
--> Processing Dependency: libgettextsrc-0.19.8.1.so()(64bit) for package: gettext-0.19.8.1-3.amzn2.x86_64
--> Processing Dependency: libgettextlib-0.19.8.1.so()(64bit) for package: gettext-0.19.8.1-3.amzn2.x86_64
--> Processing Dependency: libcroco-0.6.so.3()(64bit) for package: gettext-0.19.8.1-3.amzn2.x86_64
--> Running transaction check
---> Package gettext-libs.x86_64 0:0.19.8.1-3.amzn2 will be installed
---> Package libcroco.x86_64 0:0.6.12-6.amzn2 will be installed
---> Package libgomp.x86_64 0:7.3.1-13.amzn2 will be installed
--> Finished Dependency Resolution

Dependencies Resolved

================================================================================
 Package            Arch         Version                 Repository        Size
================================================================================
Installing:
 gettext            x86_64       0.19.8.1-3.amzn2        amzn2-core       1.0 M
Installing for dependencies:
 gettext-libs       x86_64       0.19.8.1-3.amzn2        amzn2-core       500 k
 libcroco           x86_64       0.6.12-6.amzn2          amzn2-core       103 k
 libgomp            x86_64       7.3.1-13.amzn2          amzn2-core       204 k

Transaction Summary
================================================================================
Install  1 Package (+3 Dependent packages)

Total download size: 1.8 M
Installed size: 6.8 M
Downloading packages:
--------------------------------------------------------------------------------
Total                                              9.3 MB/s | 1.8 MB  00:00     
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
  Installing : libcroco-0.6.12-6.amzn2.x86_64                               1/4 
  Installing : libgomp-7.3.1-13.amzn2.x86_64                                2/4 
  Installing : gettext-libs-0.19.8.1-3.amzn2.x86_64                         3/4 
  Installing : gettext-0.19.8.1-3.amzn2.x86_64                              4/4 
  Verifying  : libgomp-7.3.1-13.amzn2.x86_64                                1/4 
  Verifying  : gettext-libs-0.19.8.1-3.amzn2.x86_64                         2/4 
  Verifying  : gettext-0.19.8.1-3.amzn2.x86_64                              3/4 
  Verifying  : libcroco-0.6.12-6.amzn2.x86_64                               4/4 

Installed:
  gettext.x86_64 0:0.19.8.1-3.amzn2                                             

Dependency Installed:
  gettext-libs.x86_64 0:0.19.8.1-3.amzn2    libcroco.x86_64 0:0.6.12-6.amzn2   
  libgomp.x86_64 0:7.3.1-13.amzn2          

Complete!
[32;1m$ export DEPLOY_TOKEN=$(echo $GITLAB_DEPLOY_TOKEN | tr -d "\n" | base64)[0;m
[32;1m$ envsubst < templates/Dockerrun.aws.json > Dockerrun.aws.json[0;m
[32;1m$ envsubst < templates/auth.json > auth.json[0;m
[32;1m$ cat Dockerrun.aws.json[0;m
{
  "AWSEBDockerrunVersion": "1",
  "Image": {
    "Name": "phuocpro1969/mywebsite:5"
  },
  "Authentication": {
    "Bucket": "elasticbeanstalk-ap-southeast-1-035533673848",
    "Key": "auth.json"
  },
  "Ports": [
    {
      "ContainerPort": 80
    }
  ]
}[32;1m$ cat auth.json[0;m
{
    "auths": {
        "": {
            "auth": "QVdTOjlKSEdIakdSR0JHNnpjb3N5MXlG"
        }
    }
}
[32;1m$ aws s3 cp Dockerrun.aws.json s3://$AWS_S3_BUCKET/Dockerrun.aws.json[0;m
Completed 259 Bytes/259 Bytes (251 Bytes/s) with 1 file(s) remainingupload: ./Dockerrun.aws.json to s3://elasticbeanstalk-ap-southeast-1-035533673848/Dockerrun.aws.json
[32;1m$ aws s3 cp auth.json s3://$AWS_S3_BUCKET/auth.json[0;m
Completed 104 Bytes/104 Bytes (98 Bytes/s) with 1 file(s) remainingupload: ./auth.json to s3://elasticbeanstalk-ap-southeast-1-035533673848/auth.json
[32;1m$ aws elasticbeanstalk create-application-version --application-name "$APP_NAME" --version-label $APP_VERSION --source-bundle S3Bucket=$AWS_S3_BUCKET,S3Key=Dockerrun.aws.json[0;m
{
    "ApplicationVersion": {
        "ApplicationVersionArn": "arn:aws:elasticbeanstalk:ap-southeast-1:035533673848:applicationversion/my Website/5",
        "ApplicationName": "my Website",
        "VersionLabel": "5",
        "SourceBundle": {
            "S3Bucket": "elasticbeanstalk-ap-southeast-1-035533673848",
            "S3Key": "Dockerrun.aws.json"
        },
        "DateCreated": "2022-03-20T13:25:19.839000+00:00",
        "DateUpdated": "2022-03-20T13:25:19.839000+00:00",
        "Status": "UNPROCESSED"
    }
}
[32;1m$ aws elasticbeanstalk update-environment --application-name "$APP_NAME" --version-label $APP_VERSION --environment-name $APP_ENV_NAME[0;m
{
    "EnvironmentName": "Mywebsite-env",
    "EnvironmentId": "e-9tadzfpyyb",
    "ApplicationName": "my Website",
    "VersionLabel": "5",
    "SolutionStackName": "64bit Amazon Linux 2 v3.4.12 running Docker",
    "PlatformArn": "arn:aws:elasticbeanstalk:ap-southeast-1::platform/Docker running on 64bit Amazon Linux 2/3.4.12",
    "EndpointURL": "awseb-AWSEB-11IAMWESC38OG-2021957275.ap-southeast-1.elb.amazonaws.com",
    "CNAME": "Mywebsite-env.eba-7zyzgym8.ap-southeast-1.elasticbeanstalk.com",
    "DateCreated": "2022-03-20T11:13:22.672000+00:00",
    "DateUpdated": "2022-03-20T13:25:21.766000+00:00",
    "Status": "Updating",
    "AbortableOperationInProgress": true,
    "Health": "Grey",
    "Tier": {
        "Name": "WebServer",
        "Type": "Standard",
        "Version": "1.0"
    },
    "EnvironmentArn": "arn:aws:elasticbeanstalk:ap-southeast-1:035533673848:environment/my Website/Mywebsite-env"
}
[32;1m$ aws elasticbeanstalk wait environment-updated --application-name "$APP_NAME" --version-label $APP_VERSION --environment-name $APP_ENV_NAME[0;m
[32;1m$ curl $CI_ENVIRONMENT_URL/version.html | grep $APP_VERSION[0;m
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0100     2  100     2    0     0      4      0 --:--:-- --:--:-- --:--:--     4
5
section_end:1647782765:step_script[0Ksection_start:1647782765:cleanup_file_variables[0K[0K[36;1mCleaning up project directory and file based variables[0;m[0;m
section_end:1647782765:cleanup_file_variables[0K[32;1mJob succeeded[0;m
